/*(c) 2014 Kynec Studios, Andrew Mitchell | MIT License opensource.org/licenses/MIT */
/* patched version available at https://github.com/rolandmoser/digest-ajax */
!function(t){DigestAjax=function(){},DigestAjax.authHelper=function(){return{username:"",password:""}},DigestAjax.UNAUTH_HA1=null,DigestAjax.AUTH_HA1=null,DigestAjax.UNAUTH_USERNAME=null,DigestAjax.AUTH_USERNAME=null,DigestAjax.WWW_AUTHENTICATE="WWW-Authenticate",DigestAjax.ajaxDigest=function(e,n,i,r){function s(){return t.ajax(p).done(function(t,e,n){A.resolve(t,e,n)}).fail(function(t,e,n){if(401===t.status||407===t.status){var i=c(t);null!==i?a(i):A.reject(t,e,n)}else A.reject(t,e,n)})}function a(e){return void 0===p.headers&&(p.headers={}),p.headers.Authorization=e,t.ajax(p).done(function(t,e,n){null!==DigestAjax.UNAUTH_HA1&&(DigestAjax.AUTH_HA1=DigestAjax.UNAUTH_HA1,DigestAjax.UNAUTH_HA1=null),null!==DigestAjax.UNAUTH_USERNAME&&(DigestAjax.AUTH_USERNAME=DigestAjax.UNAUTH_USERNAME,DigestAjax.UNAUTH_USERNAME=null),A.resolve(t,e,n)}).fail(function(t,e,n){(401===t.status||407===t.status)&&(DigestAjax.AUTH_HA1=null,DigestAjax.AUTH_USERNAME=null),A.reject(t,e,n)})}function o(t){for(var e={},n=t.getAllResponseHeaders(),i=n.split("\r\n"),r=0;r<i.length;r++){var s=i[r].split(": ",2),a=s[0];if(""!=a){var o="";2==s.length&&(o=s[1]),e[a.toLowerCase()]=o.split("\n")}}return e}function u(t,e){return headersDict=o(t),headersDict[e.toLowerCase()]}function c(e){var n=u(e,DigestAjax.WWW_AUTHENTICATE);if(void 0===n)return null;for(var i,r=0;r<n.length;r++){i=l(n[r]);var s=i.qop;if(void 0===s||"auth"===s||"auth-int"===s){var a=i.algorithm;if(void 0===a||"MD5"===a||"MD5-sess"===a)break}}if(r===n.length)return null;var s=i.qop,o=void 0;void 0!==s&&"auth-int"===s.toLowerCase()?o="auth-int":void 0!==s&&"auth"===s.toLowerCase()&&(o="auth");var c,h,g,a=i.algorithm;if(null!==DigestAjax.AUTH_HA1)c=DigestAjax.AUTH_HA1,h=DigestAjax.AUTH_USERNAME;else{if(null===p.username||null===p.password){var d=t.extend({username:"",password:""},DigestAjax.authHelper());t.extend(p,d)}c=CryptoJS.MD5(p.username+":"+i.realm+":"+p.password),h=p.username,DigestAjax.UNAUTH_HA1=c,DigestAjax.UNAUTH_USERNAME=p.username}void 0!==a&&"md5-sess"===a.toLowerCase()&&(g=f(),c=CryptoJS.MD5(c+":"+i.nonce+":"+g));var A,D;if("auth-int"===o){var x=p.data?p.data:"";A=CryptoJS.MD5(p.type+":"+p.requestUri+":"+CryptoJS.MD5(x))}else A=CryptoJS.MD5(p.type+":"+p.requestUri);var D,j;void 0===o?D=CryptoJS.MD5(c+":"+i.nonce+":"+A):(void 0===g&&(g=f()),j="00000001",D=CryptoJS.MD5(c+":"+i.nonce+":"+j+":"+g+":"+o+":"+A));var v=[];return v.push('Digest username="',h,'",'),v.push('realm="',i.realm,'",'),v.push('nonce="',i.nonce,'",'),v.push('uri="',p.requestUri,'",'),void 0!==o&&v.push("qop=",o,","),void 0!==a&&v.push('algorithm="',a,'",'),void 0!==j&&v.push("nc=",j,","),void 0!==g&&v.push('cnonce="',g,'",'),void 0!==i.opaque&&v.push('opaque="',i.opaque,'",'),v.push('response="',D,'"'),v.join("")}function l(t){var e={},n=/([^"',\s]*)="([^"]*)/gm,i=null;do i=n.exec(t),null!==i&&(e[i[1]]=i[2]);while(null!==i);return e}function f(){for(var t="abcdef0123456789",e="",n=0;8>n;n++){var i=Math.floor(Math.random()*t.length);e+=t.substr(i,1)}return e}var h,g,p={},d=document.createElement("a");"object"==typeof e?(p=e,d.href=p.url):"string"==typeof e&&("string"==typeof n?(h=n?n:null,g=i?i:null):"object"==typeof n&&(p=n?n:{},h=i?i:null,g=r?r:null),d.href=e,p.url=e),p=t.extend({requestUri:d.pathname+d.search,username:h,password:g,type:"GET"},p);var A=t.Deferred();return A.promise(s())},DigestAjax.ajaxDigestType=function(t,e,n,i,r){return"string"==typeof n&&(r=i,i=n),"object"!=typeof n&&(n={}),n.type=t,DigestAjax.ajaxDigest(e,n,i,r)},DigestAjax.getDigest=function(t,e,n,i){return DigestAjax.ajaxDigestType("GET",t,e,n,i)},DigestAjax.postDigest=function(t,e,n,i){return DigestAjax.ajaxDigestType("POST",t,e,n,i)},DigestAjax.putDigest=function(t,e,n,i){return DigestAjax.ajaxDigestType("PUT",t,e,n,i)},DigestAjax.deleteDigest=function(t,e,n,i){return DigestAjax.ajaxDigestType("DELETE",t,e,n,i)},t.extend({authHelper:function(t){DigestAjax.authHelper=t},ajaxDigest:DigestAjax.ajaxDigest,ajaxDigestType:DigestAjax.ajaxDigestType,getDigest:DigestAjax.getDigest,postDigest:DigestAjax.postDigest,putDigest:DigestAjax.putDigest,deleteDigest:DigestAjax.deleteDigest})}(jQuery);var CryptoJS=CryptoJS||function(t,e){var n={},i=n.lib={},r=function(){},s=i.Base={extend:function(t){r.prototype=this;var e=new r;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},a=i.WordArray=s.extend({init:function(t,n){t=this.words=t||[],this.sigBytes=n!=e?n:4*t.length},toString:function(t){return(t||u).stringify(this)},concat:function(t){var e=this.words,n=t.words,i=this.sigBytes;if(t=t.sigBytes,this.clamp(),i%4)for(var r=0;t>r;r++)e[i+r>>>2]|=(n[r>>>2]>>>24-8*(r%4)&255)<<24-8*((i+r)%4);else if(65535<n.length)for(r=0;t>r;r+=4)e[i+r>>>2]=n[r>>>2];else e.push.apply(e,n);return this.sigBytes+=t,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-8*(n%4),e.length=t.ceil(n/4)},clone:function(){var t=s.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n=[],i=0;e>i;i+=4)n.push(4294967296*t.random()|0);return new a.init(n,e)}}),o=n.enc={},u=o.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],i=0;t>i;i++){var r=e[i>>>2]>>>24-8*(i%4)&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,n=[],i=0;e>i;i+=2)n[i>>>3]|=parseInt(t.substr(i,2),16)<<24-4*(i%8);return new a.init(n,e/2)}},c=o.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],i=0;t>i;i++)n.push(String.fromCharCode(e[i>>>2]>>>24-8*(i%4)&255));return n.join("")},parse:function(t){for(var e=t.length,n=[],i=0;e>i;i++)n[i>>>2]|=(255&t.charCodeAt(i))<<24-8*(i%4);return new a.init(n,e)}},l=o.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},f=i.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=l.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,i=n.words,r=n.sigBytes,s=this.blockSize,o=r/(4*s),o=e?t.ceil(o):t.max((0|o)-this._minBufferSize,0);if(e=o*s,r=t.min(4*e,r),e){for(var u=0;e>u;u+=s)this._doProcessBlock(i,u);u=i.splice(0,e),n.sigBytes-=r}return new a.init(u,r)},clone:function(){var t=s.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});i.Hasher=f.extend({cfg:s.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new h.HMAC.init(t,n).finalize(e)}}});var h=n.algo={};return n}(Math);!function(t){function e(t,e,n,i,r,s,a){return t=t+(e&n|~e&i)+r+a,(t<<s|t>>>32-s)+e}function n(t,e,n,i,r,s,a){return t=t+(e&i|n&~i)+r+a,(t<<s|t>>>32-s)+e}function i(t,e,n,i,r,s,a){return t=t+(e^n^i)+r+a,(t<<s|t>>>32-s)+e}function r(t,e,n,i,r,s,a){return t=t+(n^(e|~i))+r+a,(t<<s|t>>>32-s)+e}for(var s=CryptoJS,a=s.lib,o=a.WordArray,u=a.Hasher,a=s.algo,c=[],l=0;64>l;l++)c[l]=4294967296*t.abs(t.sin(l+1))|0;a=a.MD5=u.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,s){for(var a=0;16>a;a++){var o=s+a,u=t[o];t[o]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}var a=this._hash.words,o=t[s+0],u=t[s+1],l=t[s+2],f=t[s+3],h=t[s+4],g=t[s+5],p=t[s+6],d=t[s+7],A=t[s+8],D=t[s+9],x=t[s+10],j=t[s+11],v=t[s+12],y=t[s+13],_=t[s+14],U=t[s+15],H=a[0],m=a[1],T=a[2],w=a[3],H=e(H,m,T,w,o,7,c[0]),w=e(w,H,m,T,u,12,c[1]),T=e(T,w,H,m,l,17,c[2]),m=e(m,T,w,H,f,22,c[3]),H=e(H,m,T,w,h,7,c[4]),w=e(w,H,m,T,g,12,c[5]),T=e(T,w,H,m,p,17,c[6]),m=e(m,T,w,H,d,22,c[7]),H=e(H,m,T,w,A,7,c[8]),w=e(w,H,m,T,D,12,c[9]),T=e(T,w,H,m,x,17,c[10]),m=e(m,T,w,H,j,22,c[11]),H=e(H,m,T,w,v,7,c[12]),w=e(w,H,m,T,y,12,c[13]),T=e(T,w,H,m,_,17,c[14]),m=e(m,T,w,H,U,22,c[15]),H=n(H,m,T,w,u,5,c[16]),w=n(w,H,m,T,p,9,c[17]),T=n(T,w,H,m,j,14,c[18]),m=n(m,T,w,H,o,20,c[19]),H=n(H,m,T,w,g,5,c[20]),w=n(w,H,m,T,x,9,c[21]),T=n(T,w,H,m,U,14,c[22]),m=n(m,T,w,H,h,20,c[23]),H=n(H,m,T,w,D,5,c[24]),w=n(w,H,m,T,_,9,c[25]),T=n(T,w,H,m,f,14,c[26]),m=n(m,T,w,H,A,20,c[27]),H=n(H,m,T,w,y,5,c[28]),w=n(w,H,m,T,l,9,c[29]),T=n(T,w,H,m,d,14,c[30]),m=n(m,T,w,H,v,20,c[31]),H=i(H,m,T,w,g,4,c[32]),w=i(w,H,m,T,A,11,c[33]),T=i(T,w,H,m,j,16,c[34]),m=i(m,T,w,H,_,23,c[35]),H=i(H,m,T,w,u,4,c[36]),w=i(w,H,m,T,h,11,c[37]),T=i(T,w,H,m,d,16,c[38]),m=i(m,T,w,H,x,23,c[39]),H=i(H,m,T,w,y,4,c[40]),w=i(w,H,m,T,o,11,c[41]),T=i(T,w,H,m,f,16,c[42]),m=i(m,T,w,H,p,23,c[43]),H=i(H,m,T,w,D,4,c[44]),w=i(w,H,m,T,v,11,c[45]),T=i(T,w,H,m,U,16,c[46]),m=i(m,T,w,H,l,23,c[47]),H=r(H,m,T,w,o,6,c[48]),w=r(w,H,m,T,d,10,c[49]),T=r(T,w,H,m,_,15,c[50]),m=r(m,T,w,H,g,21,c[51]),H=r(H,m,T,w,v,6,c[52]),w=r(w,H,m,T,f,10,c[53]),T=r(T,w,H,m,x,15,c[54]),m=r(m,T,w,H,u,21,c[55]),H=r(H,m,T,w,A,6,c[56]),w=r(w,H,m,T,U,10,c[57]),T=r(T,w,H,m,p,15,c[58]),m=r(m,T,w,H,y,21,c[59]),H=r(H,m,T,w,h,6,c[60]),w=r(w,H,m,T,j,10,c[61]),T=r(T,w,H,m,l,15,c[62]),m=r(m,T,w,H,D,21,c[63]);a[0]=a[0]+H|0,a[1]=a[1]+m|0,a[2]=a[2]+T|0,a[3]=a[3]+w|0},_doFinalize:function(){var e=this._data,n=e.words,i=8*this._nDataBytes,r=8*e.sigBytes;n[r>>>5]|=128<<24-r%32;var s=t.floor(i/4294967296);for(n[(r+64>>>9<<4)+15]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n[(r+64>>>9<<4)+14]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),e.sigBytes=4*(n.length+1),this._process(),e=this._hash,n=e.words,i=0;4>i;i++)r=n[i],n[i]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8);return e},clone:function(){var t=u.clone.call(this);return t._hash=this._hash.clone(),t}}),s.MD5=u._createHelper(a),s.HmacMD5=u._createHmacHelper(a)}(Math);
